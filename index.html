<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Miciji Game</title>
<style>
  body { text-align: center; font-family: sans-serif; }
  canvas { background: #eee; display: block; margin: 20px auto; }
  #hud { margin: 10px; font-size: 18px; }
  button { margin: 5px; padding: 10px; font-size: 16px; }
</style>
</head>
<body>

<h1>Miciji Game</h1>
<div id="hud">
  Lives: <span id="lives">3</span> |
  Coins: <span id="coins">0</span> |
  Level: <span id="level">1</span>
</div>

<canvas id="gameCanvas" width="600" height="400"></canvas>

<button id="rewardBtn" style="display:none;">Watch Video (+1 Life)</button>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = { x: 300, y: 200, size: 20, lives: 3, coins: 0 };
let coins = [];
let level = 1;
const maxLevels = 4;
const keys = {};

document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Spawn coin
function spawnCoin() {
  coins.push({x: Math.random() * (canvas.width-10), y: Math.random()*(canvas.height-10), size: 10});
}

// Collision check
function collides(a,b) {
  return a.x < b.x + b.size && a.x + a.size > b.x &&
         a.y < b.y + b.size && a.y + a.size > b.y;
}

// Lose life
function loseLife() {
  player.lives--;
  updateHUD();
  if(player.lives <= 0){
    alert("Game Over! Click 'Watch Video' to get +1 life.");
    document.getElementById('rewardBtn').style.display = 'inline-block';
  } else {
    resetPlayer();
  }
}

// Reset player position
function resetPlayer() {
  player.x = canvas.width/2 - player.size/2;
  player.y = canvas.height/2 - player.size/2;
}

// Update HUD
function updateHUD() {
  document.getElementById('lives').textContent = player.lives;
  document.getElementById('coins').textContent = player.coins;
  document.getElementById('level').textContent = level;
}

// Reward video button
document.getElementById('rewardBtn').addEventListener('click', () => {
  player.lives = 1;
  updateHUD();
  document.getElementById('rewardBtn').style.display = 'none';
  resetPlayer();
});

// Game update
function update() {
  // Movement
  if(keys['ArrowUp']) player.y -= 5;
  if(keys['ArrowDown']) player.y += 5;
  if(keys['ArrowLeft']) player.x -= 5;
  if(keys['ArrowRight']) player.x += 5;

  // Unlimited area (wrap around)
  if(player.x < 0) { player.x = 0; loseLife(); }
  if(player.x + player.size > canvas.width) { player.x = canvas.width-player.size; loseLife(); }
  if(player.y < 0) { player.y = 0; loseLife(); }
  if(player.y + player.size > canvas.height) { player.y = canvas.height-player.size; loseLife(); }

  // Coin collection
  coins.forEach((c, idx) => {
    if(collides(player,c)){
      player.coins++;
      coins.splice(idx,1);
      spawnCoin();
      // Level up logic
      if(player.coins % 5 === 0){
        level++;
        if(level > maxLevels){
          alert("Game Over! You reached max level.");
          resetGame();
        }
        updateHUD();
      }
    }
  });
}

// Reset game
function resetGame() {
  player.lives = 3;
  player.coins = 0;
  level = 1;
  updateHUD();
  resetPlayer();
  coins = [];
  for(let i=0;i<5;i++) spawnCoin();
}

// Draw
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Player
  ctx.fillStyle = "green";
  ctx.fillRect(player.x, player.y, player.size, player.size);
  // Coins
  ctx.fillStyle = "gold";
  coins.forEach(c => ctx.fillRect(c.x, c.y, c.size, c.size));
}

// Game loop
function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// Init
for(let i=0;i<5;i++) spawnCoin();
updateHUD();
gameLoop();
</script>

</body>
</html>
